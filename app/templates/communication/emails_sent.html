{% extends "base.html" %}

{% block title %}Emails Envoyés{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/communication.css') }}?v=20251118a">
{% endblock %}

{% block content %}
<!-- Bannière -->
<div class="banner">
    <div class="banner-content">
        <h1>Emails Envoyés</h1>
        <p>Suivez l'historique et les statistiques de tous les emails envoyés par votre chatbot</p>
    </div>
</div>

<!-- KPI Stats -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon">
            <i data-lucide="mail"></i>
        </div>
        <div class="stat-content">
            <h3 id="total-emails">0</h3>
            <p>Total emails envoyés</p>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon success">
            <i data-lucide="check-circle"></i>
        </div>
        <div class="stat-content">
            <h3 id="delivered-emails">0</h3>
            <p>Emails délivrés</p>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon error">
            <i data-lucide="alert-circle"></i>
        </div>
        <div class="stat-content">
            <h3 id="failed-emails">0</h3>
            <p>Échecs d'envoi</p>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon">
            <i data-lucide="percent"></i>
        </div>
        <div class="stat-content">
            <h3 id="success-rate">0%</h3>
            <p>Taux de réussite</p>
        </div>
    </div>
</div>

<!-- Filtres et recherche -->
<section class="config-section">
    <div class="filters-container">
        <div class="search-box">
            <i data-lucide="search"></i>
            <input type="text" id="search-input" placeholder="Rechercher par destinataire ou objet...">
        </div>
        <div class="filter-buttons">
            <button class="filter-btn active" data-filter="all">
                <i data-lucide="list"></i> Tous
            </button>
            <button class="filter-btn" data-filter="delivered">
                <i data-lucide="check"></i> Délivrés
            </button>
            <button class="filter-btn" data-filter="failed">
                <i data-lucide="x"></i> Échecs
            </button>
        </div>
        <div class="period-filters">
            <button class="period-btn active" data-period="today">Aujourd'hui</button>
            <button class="period-btn" data-period="week">7 jours</button>
            <button class="period-btn" data-period="month">30 jours</button>
            <button class="period-btn" data-period="all">Tout</button>
        </div>
    </div>
</section>

<!-- Table des emails -->
<section class="config-section">
    <h2 class="section-title">
        <i data-lucide="inbox"></i>
        Historique des envois
    </h2>

    <div class="table-container">
        <table class="comm-table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Destinataire</th>
                    <th>Objet</th>
                    <th>Template</th>
                    <th>Statut</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="emails-tbody">
                <tr class="empty-row">
                    <td colspan="6">
                        <div class="empty-state">
                            <i data-lucide="inbox"></i>
                            <p>Aucun email envoyé pour le moment</p>
                            <small>Les emails envoyés par votre bot apparaîtront ici</small>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    <div class="pagination" id="pagination" style="display: none;">
        <button class="btn btn-sm" id="prev-page">
            <i data-lucide="chevron-left"></i> Précédent
        </button>
        <span class="page-info">Page <span id="current-page">1</span> sur <span id="total-pages">1</span></span>
        <button class="btn btn-sm" id="next-page">
            Suivant <i data-lucide="chevron-right"></i>
        </button>
    </div>
</section>

<!-- Modal détails -->
<div class="modal" id="email-modal">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h3>Détails de l'email</h3>
            <button class="close-modal" id="close-email-modal">
                <i data-lucide="x"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="email-details">
                <div class="detail-section">
                    <h4><i data-lucide="info"></i> Informations générales</h4>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <label>Destinataire</label>
                            <span id="detail-recipient">-</span>
                        </div>
                        <div class="detail-item">
                            <label>Date d'envoi</label>
                            <span id="detail-date">-</span>
                        </div>
                        <div class="detail-item">
                            <label>Template utilisé</label>
                            <span id="detail-template">-</span>
                        </div>
                        <div class="detail-item">
                            <label>Statut</label>
                            <span id="detail-status">-</span>
                        </div>
                    </div>
                </div>

                <div class="detail-section">
                    <h4><i data-lucide="file-text"></i> Contenu de l'email</h4>
                    <div class="detail-item">
                        <label>Objet</label>
                        <div class="message-box" id="detail-subject">-</div>
                    </div>
                    <div class="detail-item">
                        <label>Message</label>
                        <div class="message-box" id="detail-body">-</div>
                    </div>
                </div>

                <div class="detail-section" id="error-section" style="display: none;">
                    <h4><i data-lucide="alert-triangle"></i> Erreur</h4>
                    <div class="error-box" id="detail-error">-</div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" id="close-modal-btn">Fermer</button>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/emails_sent.js') }}?v=20251118a"></script>
{% endblock %}
