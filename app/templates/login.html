<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Connexion à votre compte</title>
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
  <!-- Votre feuille de style -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/login.css') }}?v=3">
</head>
<body>
  <div class="container">
    <div class="logo">
      <img src="{{ url_for('static', filename='images/logo-placeholder.png') }}" alt="Logo de LeoBot">
    </div>
    <h2>Connexion à votre compte</h2>

    {% if error %}
      <div class="error">{{ error }}</div>
    {% endif %}

    <form action="{{ url_for('main.login') }}" method="POST">
      <!-- Champ CSRF -->
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

      <!-- Identifiant -->
      <div class="form-group">
        <label for="username">Identifiant</label>
        <div class="input-wrapper">
          <input type="text" id="username" name="username" placeholder="Votre identifiant" required autofocus>
        </div>
      </div>

      <!-- Mot de passe -->
      <div class="form-group">
        <label for="password">Mot de passe</label>
        <div class="input-wrapper">
          <input type="password" id="password" name="password" placeholder="Votre mot de passe" required>
          <i data-lucide="eye" class="input-icon" id="togglePassword" title="Afficher le mot de passe"></i>
        </div>
      </div>

      <button type="submit">Se connecter</button>
    </form>

    <div class="footer">
      <p><a href="{{ url_for('main.forgot_password') }}">Mot de passe oublié ?</a></p>
    </div>
  </div>

  <script>
    // Initialiser Lucide icons
    lucide.createIcons();

    // Toggle password visibility
    const togglePassword = document.getElementById('togglePassword');
    const passwordInput = document.getElementById('password');

    if (togglePassword && passwordInput) {
      togglePassword.addEventListener('click', function() {
        const isPassword = passwordInput.type === 'password';
        passwordInput.type = isPassword ? 'text' : 'password';

        // Changer l'icône - Optimisé : ne recrée que cette icône
        const newIcon = isPassword ? 'eye-off' : 'eye';
        this.setAttribute('data-lucide', newIcon);

        // Ne recréer QUE cette icône, pas toute la page
        lucide.createIcons({
          attrs: {
            class: ['input-icon'],
          },
          root: this.parentElement
        });

        // Changer le titre
        this.setAttribute('title', isPassword ? 'Masquer le mot de passe' : 'Afficher le mot de passe');
      });
    }
  </script>
</body>
</html>
