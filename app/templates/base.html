<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}LeoBot{% endblock %}</title>

    <!-- Lien vers le favicon dans app/static/images -->
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='images/favicon.ico') }}">

    <!-- Feuilles de style (ex. base.css) -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">

    <!-- Balise meta pour CSRF Token -->
    <meta name="csrf-token" content="{{ csrf_token() }}">

    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- HEADER bleu commun -->
    <header class="header">
        <!-- Menu hamburger -->
        <div class="hamburger" id="hamburger-menu">
            <span></span>
            <span></span>
            <span></span>
        </div>

        <!-- Titre cliquable renvoyant sur index -->
        <h1 class="header-title">
            <a href="{{ url_for('main.home') }}" class="header-link">
                LeoBot
            </a>
        </h1>

        <!-- Icônes à droite (ex. notifications, profil, paramètres) -->
        <div class="icons">
            <div class="notification-wrapper">
                <i data-lucide="bell" id="notificationBell" title="Notifications"></i>
                {% if current_user.is_authenticated and current_user.onboarding_completed == False %}
                <span class="notification-badge" id="notificationBadge">1</span>
                {% else %}
                <span class="notification-badge" id="notificationBadge" style="display: none;"></span>
                {% endif %}
                <div class="notification-dropdown" id="notificationDropdown">
                    <div class="notification-header">
                        <span>Notifications</span>
                    </div>
                    <div class="notification-list">
                        {% if current_user.is_authenticated and current_user.onboarding_completed == False %}
                        <a href="{{ url_for('main.onboarding_wizard') }}" class="notification-item">
                            <i data-lucide="wand-2" class="notification-icon"></i>
                            <div class="notification-content">
                                <div class="notification-title">Complétez votre configuration</div>
                                <div class="notification-text">Terminez l'assistant de configuration pour profiter pleinement de votre bot</div>
                            </div>
                        </a>
                        {% else %}
                        <a href="{{ url_for('main.reopen_wizard') }}" class="notification-item">
                            <i data-lucide="wand-2" class="notification-icon"></i>
                            <div class="notification-content">
                                <div class="notification-title">Assistant de configuration</div>
                                <div class="notification-text">Relancez l'assistant pour reconfigurer votre bot</div>
                            </div>
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>
            <i data-lucide="user-circle" title="Profil"></i>
            <i data-lucide="settings" title="Paramètres"></i>
        </div>
    </header>

    <div class="container">
        <!-- SIDEBAR (fond sombre) -->
        <div class="sidebar" id="sidebar">
            <div class="menu-container">
                <ul class="menu">
                    <!-- Exemple : sous-menu LeoBot -->
                    <li class="has-submenu" id="leoBotMenu">
                        <a href="#" aria-expanded="false">
                            <!-- Icône robot -->
                            <i data-lucide="bot"></i>
                            <span class="menu-text">LeoBot</span>
                            <!-- Chevron droit par défaut -->
                            <i data-lucide="chevron-right" class="submenu-icon"></i>
                        </a>
                        <div class="submenu-container">
                            <ul class="submenu">
                                <li>
                                    <a href="{{ url_for('main.general_settings') }}">
                                        Paramètres Généraux
                                    </a>
                                </li>
                                <!-- Nouveau sous-menu pour "Contenu" -->
                                <li class="has-submenu">
                                    <a href="#" aria-expanded="false">
                                        Contenu
                                        <i data-lucide="chevron-right" class="submenu-icon"></i>
                                    </a>
                                    <div class="submenu-container">
                                        <ul class="submenu">
                                            <li>
                                                <a href="{{ url_for('main.reponses') }}">
                                                    Configuration des Réponses
                                                </a>
                                            </li>
                                            <li>
                                                <a href="{{ url_for('main.base_connaissances') }}">
                                                    Base de Connaissances
                                                </a>
                                            </li>
                                            <li>
                                                <a href="{{ url_for('main.flux_conversation') }}">
                                                    Flux de Conversation
                                                </a>
                                            </li>
                                            <li>
                                                <a href="{{ url_for('main.actions') }}">
                                                    Actions et Automatisations
                                                </a>
                                            </li>
                                            <li>
                                                <a href="{{ url_for('main.integrations_page') }}">
                                                    Canaux de Communication
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </li>
                                <li class="has-submenu">
                                    <a href="#" aria-expanded="false">
                                        Suivi et analyses
                                        <i data-lucide="chevron-right" class="submenu-icon"></i>
                                    </a>
                                    <div class="submenu-container">
                                        <ul class="submenu">
                                            <li>
                                                <a href="{{ url_for('main.metrics_page') }}">
                                                    Métriques et Analyses
                                                </a>
                                            </li>
                                            <li>
                                                <a href="{{ url_for('main.unhandled_queries_page') }}">
                                                    Requêtes non comprises
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </li>

                    <!-- Toggle Mode Simple/Avancé -->
                    <li class="mode-toggle-item">
                        <div class="mode-toggle-container">
                            <div class="mode-status">
                                <span class="mode-label">Mode Simple</span>
                                <small class="mode-hint">Fonctions essentielles</small>
                            </div>
                            <button class="mode-toggle-btn" onclick="toggleUIMode()" title="Passer en mode avancé">
                                <i data-lucide="rocket"></i>
                            </button>
                        </div>
                    </li>

                    <!-- Exemple : Configuration -->
                    <li class="has-submenu advanced-only" id="configurationMenu" style="display: none;">
                        <a href="#" aria-expanded="false">
                            <i data-lucide="settings"></i>
                            <span class="menu-text">Configuration</span>
                            <i data-lucide="chevron-right" class="submenu-icon"></i>
                        </a>
                        <div class="submenu-container">
                            <ul class="submenu">
                                <li><a href="{{ url_for('main.config_api') }}">API</a></li>
                                <li class="has-submenu">
                                    <a href="#" aria-expanded="false">
                                        Intégration
                                        <i data-lucide="chevron-right" class="submenu-icon"></i>
                                    </a>
                                    <div class="submenu-container">
                                        <ul class="submenu">
                                            <li class="has-submenu">
                                                <a href="#" aria-expanded="false">
                                                    Email
                                                    <i data-lucide="chevron-right" class="submenu-icon"></i>
                                                </a>
                                                <div class="submenu-container">
                                                    <ul class="submenu">
                                                        <li><a href="{{ url_for('main.smtp_settings') }}">Paramètres SMTP</a></li>
                                                        <li><a href="#">Modèles d'Emails</a></li>
                                                    </ul>
                                                </div>
                                            </li>
                                            <li class="has-submenu">
                                                <a href="#" aria-expanded="false">
                                                    SMS
                                                    <i data-lucide="chevron-right" class="submenu-icon"></i>
                                                </a>
                                                <div class="submenu-container">
                                                    <ul class="submenu">
                                                        <li><a href="{{ url_for('main.sms_configuration') }}">Choix du fournisseur</a></li>
                                                        <li><a href="#">Modèles de SMS</a></li>
                                                    </ul>
                                                </div>
                                            </li>
                                        </ul>
                                    </div>
                                </li>
                                <li class="has-submenu">
                                    <a href="#" aria-expanded="false">
                                        Gestion des comptes
                                        <i data-lucide="chevron-right" class="submenu-icon"></i>
                                    </a>
                                    <div class="submenu-container">
                                        <ul class="submenu">
                                            <li><a href="#">Paramètres de connexion</a></li>
                                            <li><a href="#">Utilisateur</a></li>
                                        </ul>
                                    </div>
                                </li>
                                <li><a href="#">Options Avancées</a></li>
                            </ul>
                        </div>
                    </li>

                    <!-- Exemple : Canaux de Communication -->
                    <li class="has-submenu advanced-only" id="communicationMenu" style="display: none;">
                        <a href="#" aria-expanded="false">
                            <i data-lucide="messages-square"></i>
                            <span class="menu-text">Canaux de Communication</span>
                            <i data-lucide="chevron-right" class="submenu-icon"></i>
                        </a>
                        <div class="submenu-container">
                            <ul class="submenu">
                                <li><a href="#">Nombre d'e-mails envoyés</a></li>
                                <li><a href="#">Nombre de SMS envoyés</a></li>
                                <li><a href="#">Réponses emails/SMS</a></li>
                            </ul>
                        </div>
                    </li>

                    <!-- Exemple : Recommandations -->
                    <li class="has-submenu advanced-only" id="recommendationMenu" style="display: none;">
                        <a href="#" aria-expanded="false">
                            <i data-lucide="star"></i>
                            <span class="menu-text">Recommandations</span>
                            <i data-lucide="chevron-right" class="submenu-icon"></i>
                        </a>
                        <div class="submenu-container">
                            <ul class="submenu">
                                <li><a href="#">Créer une recommandation</a></li>
                                <li><a href="#">Suggestions de recommandation</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </div>

            <!-- Lien de déconnexion mis à jour -->
            <a href="{{ url_for('main.logout') }}" class="logout-link">
                <i data-lucide="log-out"></i>
                <span class="menu-text">Déconnexion</span>
            </a>
        </div>

        <!-- Contenu principal (spécifique à chaque page) -->
        <div class="main-content">
            <!-- Section des messages flash -->
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    <div class="flash-messages">
                        {% for category, message in messages %}
                            <div class="flash {{ category }}">{{ message }}</div>
                        {% endfor %}
                    </div>
                {% endif %}
            {% endwith %}

            {% block content %}{% endblock %}
        </div>
    </div>

    <!-- Footer commun -->
    <footer class="footer">
        <p>
            LeoBot @ 2025. Tous droits réservés.
            Propulsé par
            <a href="https://pixfeed.net/" target="_blank">Pixfeed</a>
        </p>
    </footer>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
        // Initialiser les icônes Lucide
        lucide.createIcons();
    </script>

    <!-- Script JS commun (pour le hamburger, la sidebar, etc.) -->
    <script src="{{ url_for('static', filename='js/base.js') }}"></script>

    {% block extra_js %}{% endblock %}
</body>
</html>