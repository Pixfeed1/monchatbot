{% extends "base.html" %}

{% block title %}Flux de Conversation{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/flux_conversation.css') }}">
{% endblock %}

{% block content %}
<div class="flow-container">
    <!-- Bannière -->
    <div class="banner">
        <div class="banner-content">
            <h1>Flux de Conversation</h1>
            <p>Créez des parcours conversationnels intelligents pour votre bot</p>
        </div>
    </div>

    <!-- Actions rapides -->
    <div class="quick-actions">
        <button class="btn-primary" id="newFlowBtn">
            <i data-lucide="plus"></i>
            Nouveau Flux
        </button>
        <button class="btn-secondary" id="importFlowBtn">
            <i data-lucide="upload"></i>
            Importer
        </button>
        <button class="btn-secondary" id="exportFlowBtn">
            <i data-lucide="download"></i>
            Exporter
        </button>
    </div>

    <!-- Liste des flux -->
    <section class="config-section">
        <div class="section-header-with-actions">
            <h2 class="section-title">
                <i data-lucide="git-branch"></i>
                Mes Flux
            </h2>
            <div class="header-actions">
                <input type="text" class="flow-search" placeholder="Rechercher un flux...">
                <button class="btn-icon" id="refreshFlows">
                    <i data-lucide="refresh-cw"></i>
                </button>
            </div>
        </div>

        <div class="flows" id="flowsGrid">
            <div class="empty-state">
                <i data-lucide="git-branch"></i>
                <p>Aucun flux créé</p>
                <small>Commencez par créer votre premier flux de conversation</small>
            </div>
        </div>
    </section>

    <!-- Éditeur de flux (affiché uniquement quand un flux est sélectionné) -->
    <div class="flow-editor" id="flowEditor" style="display: block;">
        <div class="editor-header">
            <input type="text" class="flow-name" placeholder="Nom du flux">
            <div class="editor-actions">
                <button class="btn-secondary" id="testFlowBtn">
                    <i data-lucide="play"></i>
                    Tester
                </button>
                <button class="btn-primary" id="saveFlowBtn">
                    <i data-lucide="save"></i>
                    Enregistrer
                </button>
                <button class="btn-icon" id="closeEditorBtn">
                    <i data-lucide="x"></i>
                </button>
            </div>
        </div>

        <div class="editor-workspace">
            <!-- Palette d'éléments -->
            <div class="node-palette">
                <h3>Éléments</h3>
                <div class="node-item" draggable="true" data-type="message">
                    <i data-lucide="message-circle"></i>
                    <span>Message</span>
                </div>
                <div class="node-item" draggable="true" data-type="condition">
                    <i data-lucide="git-branch"></i>
                    <span>Condition</span>
                </div>
                <div class="node-item" draggable="true" data-type="input">
                    <i data-lucide="type"></i>
                    <span>Saisie Utilisateur</span>
                </div>
                <div class="node-item" draggable="true" data-type="action">
                    <i data-lucide="zap"></i>
                    <span>Action</span>
                </div>
                <div class="node-item" draggable="true" data-type="api">
                    <i data-lucide="plug"></i>
                    <span>Appel API</span>
                </div>
            </div>

            <!-- Canvas de construction -->
            <div class="flow-canvas" id="flowCanvas">
                <div class="flow-nodes" id="flowNodes">
                    <!-- Les nœuds seront ajoutés ici par glisser-déposer -->
                </div>
            </div>

            <!-- Propriétés du nœud sélectionné -->
            <div class="node-properties" id="nodeProperties">
                <h3>Propriétés</h3>
                <div class="properties-content" id="propertiesContent">
                    <div class="empty-state">
                        <i data-lucide="info"></i>
                        <small>Sélectionnez un élément pour modifier ses propriétés</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal de test -->
<div class="modal" id="testModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Test du Flux</h3>
            <button class="modal-close" id="closeTestModal">
                <i data-lucide="x"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="test-conversation" id="testConversation">
                <!-- Les messages de test s'afficheront ici -->
            </div>
            <div class="test-input-area">
                <input type="text" id="testInput" class="test-input" placeholder="Tapez votre message...">
                <button class="btn-primary" id="sendTestMessage">
                    <i data-lucide="send"></i>
                </button>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-secondary" id="resetTest">
                <i data-lucide="rotate-ccw"></i>
                Recommencer
            </button>
            <button class="btn-secondary" id="closeTest">Fermer</button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/flux_conversation.js') }}"></script>
{% endblock %}
