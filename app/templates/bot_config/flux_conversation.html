{% extends "base.html" %}

{% block title %}Flux de Conversation{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/common.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/flux_conversation.css') }}">
{% endblock %}

{% block content %}
<div class="flow-container">
    <h1>Configuration des Flux de Conversation</h1>

    <!-- Barre d'outils avec classes communes -->
    <div class="toolbar">
        <div class="toolbar-left">
            <button class="btn btn-primary" id="newFlowBtn">
                <i data-lucide="plus"></i> Nouveau Flux
            </button>
            <button class="btn btn-secondary" id="saveFlowBtn">
                <i data-lucide="save"></i> Enregistrer
            </button>
            <button class="btn btn-secondary" id="testFlowBtn">
                <i data-lucide="play"></i> Tester
            </button>
        </div>
        <div class="toolbar-right">
            <button class="btn btn-outline-secondary" id="importFlowBtn">
                <i data-lucide="file-down"></i> Importer
            </button>
            <button class="btn btn-outline-secondary" id="exportFlowBtn">
                <i data-lucide="file-up"></i> Exporter
            </button>
        </div>
    </div>

    <!-- Zone principale -->
    <div class="flow-workspace">
        <!-- Liste des flux (sidebar gauche) -->
        <div class="flow-list sidebar">
            <div class="sidebar-header list-header">
                <h3>Mes Flux</h3>
                <input type="text" placeholder="Rechercher un flux..." class="flow-search form-control">
            </div>
            <div class="sidebar-content flows">
                <!-- Les flux seront injectés ici par JavaScript -->
            </div>
        </div>

        <!-- Éditeur de flux (zone centrale) -->
        <div class="flow-editor card">
            <div class="card-header editor-header">
                <input type="text" class="flow-name" placeholder="Nom du flux">
                <div class="editor-actions">
                    <button class="btn btn-primary" id="saveFlowBtn">
                        <i data-lucide="save"></i> Enregistrer
                    </button>
                    <button class="btn btn-secondary" id="testFlowBtn">
                        <i data-lucide="play"></i> Tester
                    </button>
                </div>
            </div>

            <!-- Zone de construction du flux -->
            <div class="card-body flow-builder">
                <!-- Palette de nœuds (colonne gauche) -->
                <div class="node-palette">
                    <h4>Éléments</h4>
                    <div class="node-item" draggable="true" data-type="message">
                        <i data-lucide="message-circle"></i>
                        <span>Message</span>
                    </div>
                    <div class="node-item" draggable="true" data-type="condition">
                        <i data-lucide="git-branch"></i>
                        <span>Condition</span>
                    </div>
                    <div class="node-item" draggable="true" data-type="input">
                        <i data-lucide="type"></i>
                        <span>Saisie</span>
                    </div>
                    <div class="node-item" draggable="true" data-type="action">
                        <i data-lucide="zap"></i>
                        <span>Action</span>
                    </div>
                    <div class="node-item" draggable="true" data-type="api">
                        <i data-lucide="plug"></i>
                        <span>API</span>
                    </div>
                </div>

                <!-- Canvas de flux (zone centrale) -->
                <div class="flow-canvas">
                    <div class="flow-nodes" id="flowNodes">
                        <!-- Les nœuds et connexions seront ajoutés ici -->
                    </div>
                </div>

                <!-- Panneau de propriétés (colonne droite) -->
                <div class="node-properties">
                    <h4>Propriétés</h4>
                    <div class="properties-content">
                        <div class="properties-empty">
                            Sélectionnez un nœud pour voir ses propriétés
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de test avec classes communes -->
    <div class="modal" id="testModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Test du Flux</h3>
                <button class="modal-close" onclick="document.getElementById('testModal').classList.remove('active')">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="test-conversation">
                    <!-- La conversation de test sera affichée ici -->
                </div>
                <div class="test-input">
                    <input type="text" class="form-control" placeholder="Entrez votre message...">
                    <button class="btn btn-primary">
                        <i data-lucide="send"></i> Envoyer
                    </button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="document.getElementById('testModal').classList.remove('active')">
                    Fermer
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/flux_conversation.js') }}"></script>
{% endblock %}
