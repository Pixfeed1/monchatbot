{% extends "base.html" %}

{% block title %}Configuration des R√©ponses{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/content.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/reponses.css') }}">
{% endblock %}

{% block content %}
<div class="responses-container">
<!-- En-t√™te avec assistant de configuration -->
    <div class="responses-header">
        <h1><i data-lucide="bot"></i> Configuration des R√©ponses du Bot</h1>
        <p class="subtitle">Configurez les r√©ponses automatiques en 3 √©tapes simples</p>
        
        <!-- Indicateur de progression -->
        <div class="progress-indicator">
            <div class="progress-step active" data-step="1">
                <span class="step-number">1</span>
                <span class="step-label">Messages de base</span>
            </div>
            <div class="progress-step" data-step="2">
                <span class="step-number">2</span>
                <span class="step-label">R√©ponses sp√©cialis√©es</span>
            </div>
            <div class="progress-step" data-step="3">
                <span class="step-number">3</span>
                <span class="step-label">Situations d'erreur</span>
            </div>
        </div>
    </div>

    <!-- √âtat de sauvegarde -->
    <div class="save-status" id="saveStatus">
        <div class="status-indicator">
            <i data-lucide="check-circle"></i>
            <span>Toutes les modifications sont sauvegard√©es</span>
        </div>
    </div>

    <!-- Exemples rapides -->
    <div class="quick-examples">
        <div class="examples-header">
            <h3><i data-lucide="lightbulb"></i> Besoin d'aide pour d√©marrer ?</h3>
            <p>Chargez un exemple pr√©-configur√© en 1 clic :</p>
        </div>
        <div class="examples-buttons">
            <button class="example-btn" data-example="professional">
                <i data-lucide="briefcase"></i>
                <span>Bot Professionnel</span>
                <small>Formel et courtois</small>
            </button>
            <button class="example-btn" data-example="friendly">
                <i data-lucide="smile"></i>
                <span>Bot Amical</span>
                <small>D√©contract√© et chaleureux</small>
            </button>
            <button class="example-btn" data-example="support">
                <i data-lucide="headphones"></i>
                <span>Service Client</span>
                <small>Assist√© et efficace</small>
            </button>
        </div>
    </div>

    <!-- Navigation simplifi√©e -->
    <div class="wizard-navigation">
        <button class="nav-btn active" data-section="essentials">
            <i data-lucide="star"></i>
            <span>Messages de Base</span>
            <small>Bonjour, au revoir, merci...</small>
        </button>
        <button class="nav-btn" data-section="specialized">
            <i data-lucide="wrench"></i>
            <span>R√©ponses pour Votre Activit√©</span>
            <small>Questions fr√©quentes de vos clients</small>
        </button>
        <button class="nav-btn" data-section="advanced">
            <i data-lucide="settings"></i>
            <span>Gestion des Erreurs</span>
            <small>Quand le bot ne comprend pas</small>
        </button>
    </div>

    <!-- Section Messages Essentiels -->
    <div class="wizard-section active" id="essentials">
        <div class="section-header">
            <h2>Messages de Base</h2>
            <p>Les r√©ponses automatiques pour les situations courantes</p>
        </div>

        <!-- Message de bienvenue -->
        <div class="essential-card welcome-card">
            <div class="card-header">
                <div class="card-icon">
                    <i data-lucide="hand"></i>
                </div>
                <div class="card-title">
                    <h3>
                        Message de Bienvenue
                        <span class="help-icon" title="C'est la premi√®re chose que vos visiteurs verront quand ils ouvrent le chat. Soyez accueillant !">‚ÑπÔ∏è</span>
                    </h3>
                    <p>Premier message que voient vos visiteurs</p>
                </div>
                <div class="card-status">
                    <span class="status-badge required">Obligatoire</span>
                </div>
            </div>
            <div class="card-content">
                <div class="message-preview">
                    <div class="bot-bubble">
                        <span id="welcomePreview">Bonjour ! Comment puis-je vous aider aujourd'hui ?</span>
                    </div>
                </div>
                <div class="message-editor">
                    <textarea class="smart-textarea" data-preview="welcomePreview" rows="3"
                              placeholder="√âcrivez votre message de bienvenue...">{{ settings.bot_welcome if settings.bot_welcome else 'Bonjour ! Comment puis-je vous aider aujourd\'hui ?' }}</textarea>
                    <div class="editor-help">
                        <small>üí° <strong>Astuce :</strong> Rendez-le personnel et chaleureux. Exemples : "Bienvenue ! Je suis l√† pour vous aider üòä" ou "Bonjour, que puis-je faire pour vous aujourd'hui ?"</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Templates de r√©ponses essentielles -->
        <div class="templates-grid">
            <!-- Salutations -->
            <div class="template-card" data-category="greeting">
                <div class="template-header">
                    <i class="fas fa-comments template-icon"></i>
                    <h3>Salutations</h3>
                    <button class="toggle-template active">
                        <i data-lucide="toggle-right"></i>
                    </button>
                </div>
                <div class="template-content">
                    <div class="quick-setup">
                        <p><strong>D√©clench√© par:</strong> bonjour, salut, hello, bonsoir</p>
                        <div class="response-options">
                            <label class="radio-option">
                                <input type="radio" name="greeting-style" value="formal" checked>
                                <span class="option-label">Formel</span>
                                <span class="option-preview">"Bonjour, comment puis-je vous aider ?"</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="greeting-style" value="friendly">
                                <span class="option-label">Amical</span>
                                <span class="option-preview">"Salut ! Que puis-je faire pour toi ?"</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="greeting-style" value="custom">
                                <span class="option-label">Personnalis√©</span>
                                <input type="text" class="custom-input" placeholder="Votre r√©ponse personnalis√©e...">
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Au revoir -->
            <div class="template-card" data-category="goodbye">
                <div class="template-header">
                    <i class="fas fa-hand-peace template-icon"></i>
                    <h3>Au revoir</h3>
                    <button class="toggle-template active">
                        <i data-lucide="toggle-right"></i>
                    </button>
                </div>
                <div class="template-content">
                    <div class="quick-setup">
                        <p><strong>D√©clench√© par:</strong> au revoir, bye, √† bient√¥t, merci</p>
                        <div class="response-options">
                            <label class="radio-option">
                                <input type="radio" name="goodbye-style" value="polite" checked>
                                <span class="option-label">Poli</span>
                                <span class="option-preview">"Au revoir, bonne journ√©e !"</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="goodbye-style" value="helpful">
                                <span class="option-label">Serviable</span>
                                <span class="option-preview">"N'h√©sitez pas √† revenir si vous avez d'autres questions !"</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="goodbye-style" value="custom">
                                <span class="option-label">Personnalis√©</span>
                                <input type="text" class="custom-input" placeholder="Votre message d'au revoir...">
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Remerciements -->
            <div class="template-card" data-category="thanks">
                <div class="template-header">
                    <i class="fas fa-heart template-icon"></i>
                    <h3>Remerciements</h3>
                    <button class="toggle-template active">
                        <i data-lucide="toggle-right"></i>
                    </button>
                </div>
                <div class="template-content">
                    <div class="quick-setup">
                        <p><strong>D√©clench√© par:</strong> merci, thanks, super</p>
                        <div class="response-options">
                            <label class="radio-option">
                                <input type="radio" name="thanks-style" value="simple" checked>
                                <span class="option-label">Simple</span>
                                <span class="option-preview">"De rien, ravi d'avoir pu vous aider !"</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="thanks-style" value="encouraging">
                                <span class="option-label">Encourageant</span>
                                <span class="option-preview">"Avec plaisir ! Je suis l√† si vous avez d'autres questions."</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Incompr√©hension -->
            <div class="template-card" data-category="unclear">
                <div class="template-header">
                    <i class="fas fa-question-circle template-icon"></i>
                    <h3>Question pas claire</h3>
                    <button class="toggle-template active">
                        <i data-lucide="toggle-right"></i>
                    </button>
                </div>
                <div class="template-content">
                    <div class="quick-setup">
                        <p><strong>Utilis√© quand:</strong> La question n'est pas comprise</p>
                        <div class="response-options">
                            <label class="radio-option">
                                <input type="radio" name="unclear-style" value="helpful" checked>
                                <span class="option-label">Bienveillant</span>
                                <span class="option-preview">"Pourriez-vous reformuler votre question ? Je veux √™tre s√ªr de bien vous aider."</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="unclear-style" value="guiding">
                                <span class="option-label">Guidant</span>
                                <span class="option-preview">"Je ne suis pas s√ªr de comprendre. Pouvez-vous me donner plus de d√©tails ?"</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Testeur rapide -->
        <div class="quick-tester">
            <h3>
                <i data-lucide="beaker"></i> Essayez Vos R√©ponses
                <span class="help-icon" title="Tapez un message pour voir comment le bot r√©pondrait. Parfait pour v√©rifier que vos r√©ponses fonctionnent bien !">‚ÑπÔ∏è</span>
            </h3>
            <div class="tester-input">
                <input type="text" class="test-input" placeholder="Tapez 'bonjour' pour voir comment le bot r√©pond...">
                <button class="test-btn">Tester</button>
            </div>
            <div class="test-result">
                <div class="bot-response">
                    <i data-lucide="bot"></i>
                    <span id="testResponse">Tapez un message pour voir la r√©ponse</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Section R√©ponses M√©tier -->
    <div class="wizard-section" id="specialized">
        <div class="section-header">
            <h2>R√©ponses pour Votre Activit√©</h2>
            <p>Cr√©ez des r√©ponses pour les questions fr√©quentes de vos clients</p>
        </div>

        <!-- Assistant de cr√©ation -->
        <div class="creation-assistant">
            <div class="assistant-header">
                <i data-lucide="wand-2"></i>
                <h3>
                    Cr√©er une Nouvelle R√©ponse
                    <span class="help-icon" title="Cliquez sur un bouton ci-dessous pour cr√©er une r√©ponse automatique. Le bot r√©pondra quand vos clients poseront des questions sur ce sujet.">‚ÑπÔ∏è</span>
                </h3>
            </div>
            <div class="assistant-content">
                <div class="scenario-selector">
                    <h4>Choisissez un sc√©nario courant :</h4>
                    <div class="scenarios-grid">
                        <button class="scenario-btn" data-scenario="services">
                            <i data-lucide="briefcase"></i>
                            <span>Pr√©senter mes services</span>
                        </button>
                        <button class="scenario-btn" data-scenario="pricing">
                            <i data-lucide="euro"></i>
                            <span>Questions de tarifs</span>
                        </button>
                        <button class="scenario-btn" data-scenario="contact">
                            <i data-lucide="phone"></i>
                            <span>Informations de contact</span>
                        </button>
                        <button class="scenario-btn" data-scenario="hours">
                            <i data-lucide="clock"></i>
                            <span>Horaires d'ouverture</span>
                        </button>
                        <button class="scenario-btn" data-scenario="faq">
                            <i data-lucide="help-circle"></i>
                            <span>Question fr√©quente</span>
                        </button>
                        <button class="scenario-btn" data-scenario="custom">
                            <i data-lucide="plus"></i>
                            <span>Autre r√©ponse</span>
                        </button>
                    </div>
                </div>

                <!-- Formulaire de cr√©ation guid√©e -->
                <div class="guided-form" id="guidedForm" style="display: none;">
                    <div class="form-step">
                        <label>Quels mots-cl√©s d√©clenchent cette r√©ponse ?</label>
                        <div class="keywords-input">
                            <input type="text" id="keywordsInput" placeholder="Ex: prix, tarif, co√ªt">
                            <div class="keywords-suggestions">
                                <span class="suggestion-tag">prix</span>
                                <span class="suggestion-tag">tarif</span>
                                <span class="suggestion-tag">co√ªt</span>
                                <span class="suggestion-tag">combien</span>
                            </div>
                        </div>
                    </div>
                    <div class="form-step">
                        <label>R√©ponse √† donner :</label>
                        <textarea id="responseInput" rows="4" placeholder="Votre r√©ponse..."></textarea>
                        <div class="response-tips">
                            <small>üí° Conseil: Soyez pr√©cis et utile. Proposez une action si possible.</small>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button class="btn-secondary" id="cancelForm">Annuler</button>
                        <button class="btn-primary" id="saveResponse">Ajouter cette r√©ponse</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Liste des r√©ponses m√©tier cr√©√©es -->
        <div class="custom-responses" id="customResponses">
            <h3>Vos R√©ponses M√©tier</h3>
            <div class="responses-list" id="businessResponsesList">
                <div class="empty-state">
                    <i data-lucide="lightbulb"></i>
                    <p>Aucune r√©ponse personnalis√©e pour le moment</p>
                    <small>Cliquez sur un bouton ci-dessus pour en cr√©er une</small>
                </div>
            </div>
        </div>

        <!-- Vocabulaire m√©tier -->
        <div class="vocabulary-section">
            <h3>
                <i data-lucide="book-open"></i> Mots-Cl√©s Importants
                <span class="help-icon" title="Si votre m√©tier utilise des mots particuliers (ex: 'devis', 'consultation'), ajoutez-les ici avec leur signification. Le bot les comprendra mieux !">‚ÑπÔ∏è</span>
            </h3>
            <p>Apprenez au bot les mots sp√©cifiques de votre activit√©</p>

            <div class="vocabulary-quick-add">
                <div class="vocab-input-group">
                    <input type="text" id="termInput" placeholder="Mot important (ex: devis, rendez-vous...)">
                    <input type="text" id="definitionInput" placeholder="Ce que √ßa veut dire ou mots similaires">
                    <button class="add-vocab-btn">
                        <i data-lucide="plus"></i>
                        Ajouter
                    </button>
                </div>
            </div>

            <div class="vocabulary-list" id="vocabularyList">
                <!-- Les termes ajout√©s appara√Ætront ici -->
            </div>
        </div>
    </div>

    <!-- Section Configuration Avanc√©e -->
    <div class="wizard-section" id="advanced">
        <div class="section-header">
            <h2>Gestion des Erreurs</h2>
            <p>Que doit dire le bot quand quelque chose ne va pas ?</p>
        </div>

        <!-- Messages d'erreur -->
        <div class="error-management">
            <h3>
                <i data-lucide="alert-triangle"></i> Quand il y a un Probl√®me
                <span class="help-icon" title="Personne n'aime les erreurs ! Mais quand √ßa arrive, autant que le message soit sympa. Personnalisez ce que le bot dit quand il rencontre un probl√®me technique.">‚ÑπÔ∏è</span>
            </h3>
            <p>Personnalisez les messages en cas de probl√®me</p>

            <div class="error-templates">
                <div class="error-card">
                    <div class="error-header">
                        <div class="error-icon">
                            <i data-lucide="hourglass"></i>
                        </div>
                        <div class="error-info">
                            <h4>Temps de r√©ponse d√©pass√©</h4>
                            <span class="error-code">TIMEOUT</span>
                        </div>
                    </div>
                    <div class="error-content">
                        <textarea rows="3">Je prends un peu plus de temps que pr√©vu pour traiter votre demande. Pouvez-vous patienter quelques instants ou reformuler votre question ?</textarea>
                    </div>
                </div>

                <div class="error-card">
                    <div class="error-header">
                        <div class="error-icon">
                            <i data-lucide="alert-circle"></i>
                        </div>
                        <div class="error-info">
                            <h4>Erreur technique</h4>
                            <span class="error-code">SYSTEM_ERROR</span>
                        </div>
                    </div>
                    <div class="error-content">
                        <textarea rows="3">Je rencontre un petit probl√®me technique. Pouvez-vous r√©essayer dans quelques minutes ? Si le probl√®me persiste, contactez notre support.</textarea>
                    </div>
                </div>

                <div class="error-card">
                    <div class="error-header">
                        <div class="error-icon">
                            <i data-lucide="ban"></i>
                        </div>
                        <div class="error-info">
                            <h4>Limite atteinte</h4>
                            <span class="error-code">RATE_LIMIT</span>
                        </div>
                    </div>
                    <div class="error-content">
                        <textarea rows="3">Vous avez fait beaucoup de demandes r√©cemment. Merci de patienter quelques minutes avant de continuer.</textarea>
                    </div>
                </div>
            </div>
        </div>

        <!-- Configuration du comportement -->
        <div class="behavior-config">
            <h3>
                <i data-lucide="sliders"></i> Comment le Bot R√©agit
                <span class="help-icon" title="Ajustez le comportement du bot : strict ou flexible ? Doit-il se souvenir de la conversation ? Configurez-le selon vos besoins.">‚ÑπÔ∏è</span>
            </h3>

            <div class="config-options">
                <div class="option-group">
                    <label class="option-label">
                        <input type="checkbox" checked>
                        <span class="checkmark"></span>
                        <div class="option-content">
                            <strong>Comprendre les fautes de frappe</strong>
                            <small>Le bot reconna√Æt les variations d'orthographe ("bonjur" ‚Üí "bonjour"). Recommand√© pour la plupart des cas ‚úÖ</small>
                        </div>
                    </label>
                </div>

                <div class="option-group">
                    <label class="option-label">
                        <input type="checkbox" checked>
                        <span class="checkmark"></span>
                        <div class="option-content">
                            <strong>Se souvenir de la conversation</strong>
                            <small>Le bot adapte ses r√©ponses selon ce qui a √©t√© dit avant. Rend la conversation plus naturelle ‚úÖ</small>
                        </div>
                    </label>
                </div>

                <div class="option-group">
                    <label class="option-label">
                        <input type="checkbox">
                        <span class="checkmark"></span>
                        <div class="option-content">
                            <strong>√ätre tr√®s strict</strong>
                            <small>Ne r√©pondre que si le message correspond exactement. Utile pour des r√©ponses tr√®s sp√©cifiques (ex: codes, r√©f√©rences)</small>
                        </div>
                    </label>
                </div>
            </div>
        </div>
    </div>

    <!-- Actions globales -->
    <div class="global-actions">
        <div class="actions-left">
            <button class="btn-secondary" id="resetAll">
                <i data-lucide="undo"></i>
                R√©initialiser
            </button>
            <button class="btn-secondary" id="exportConfig">
                <i data-lucide="download"></i>
                Exporter
            </button>
        </div>
        <div class="actions-right">
            <button class="btn-primary" id="saveAll">
                <i data-lucide="save"></i>
                Tout Sauvegarder
            </button>
        </div>
    </div>
</div>

<!-- Modales -->
<!-- Modal d'onboarding (premi√®re visite) -->
<div class="modal onboarding-modal" id="onboardingModal">
    <div class="modal-content onboarding-content">
        <div class="modal-header onboarding-header">
            <h2><i data-lucide="rocket"></i> Bienvenue dans la Configuration des R√©ponses !</h2>
            <button class="modal-close" id="onboardingClose">&times;</button>
        </div>
        <div class="modal-body onboarding-body">
            <div class="onboarding-intro">
                <p class="intro-text">Configurez votre bot en <strong>3 √©tapes simples</strong> :</p>
            </div>

            <div class="onboarding-steps">
                <div class="onboarding-step">
                    <div class="step-icon">
                        <i data-lucide="star"></i>
                    </div>
                    <div class="step-content">
                        <h3>1. Messages de Base</h3>
                        <p>Cr√©ez les r√©ponses essentielles : bonjour, au revoir, merci...</p>
                    </div>
                </div>

                <div class="onboarding-step">
                    <div class="step-icon">
                        <i data-lucide="wrench"></i>
                    </div>
                    <div class="step-content">
                        <h3>2. R√©ponses pour Votre Activit√©</h3>
                        <p>Ajoutez des r√©ponses aux questions fr√©quentes de vos clients</p>
                    </div>
                </div>

                <div class="onboarding-step">
                    <div class="step-icon">
                        <i data-lucide="settings"></i>
                    </div>
                    <div class="step-content">
                        <h3>3. Gestion des Erreurs</h3>
                        <p>D√©finissez ce que dit le bot en cas de probl√®me</p>
                    </div>
                </div>
            </div>

            <div class="onboarding-tip">
                <i data-lucide="lightbulb"></i>
                <p><strong>Conseil :</strong> Utilisez les exemples pr√©-configur√©s ci-dessous pour d√©marrer rapidement !</p>
            </div>
        </div>
        <div class="modal-footer onboarding-footer">
            <label class="dont-show-again">
                <input type="checkbox" id="dontShowAgain">
                <span>Ne plus afficher ce message</span>
            </label>
            <button class="btn-primary btn-start" id="startButton">
                <i data-lucide="arrow-right"></i>
                Commencer
            </button>
        </div>
    </div>
</div>

<!-- Modal de confirmation -->
<div class="modal" id="confirmModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Confirmation</h3>
            <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
            <p id="confirmMessage">√ätes-vous s√ªr de vouloir effectuer cette action ?</p>
        </div>
        <div class="modal-footer">
            <button class="btn-secondary" id="confirmCancel">Annuler</button>
            <button class="btn-primary" id="confirmOk">Confirmer</button>
        </div>
    </div>
</div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/reponses.js') }}"></script>
{% endblock %}